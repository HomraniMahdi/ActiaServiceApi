groups:
  - name: targets
    rules:
      - alert: monitor_service_down
        expr: up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Monitor service non-operational"
          description: "Service {{ $labels.instance }} is down."

  - name: monitoring_down
    rules:
      - alert: job_down
        expr: up{job="monitoring"} == 0
        for: 15s
        labels:
          severity: warning
        annotations:
          summary: "Job is down"
          description: "The `monitoring` job is down on instance {{ $labels.instance }}."


  - name: http_response_time
    rules:
      - alert: http_response_time
        expr: max(http_server_requests_seconds_sum{application="Monitoring-App", instance="monitoring-app:8081", status=~"2..|4..|5..", uri!~"/actuator/prometheus"}) by (method, endpoint) > 10
        for: 15s
        labels:
          severity: warning
        annotations:
          summary: "High HTTP response time"
          description: "The `Monitoring-App` instance {{ $labels.instance }} has an average HTTP response time of {{ humanizeDuration $value }} in the last 15 seconds."
      - alert: http_response_time
        expr: max(http_server_requests_seconds_sum{application="Monitoring-App", instance="monitoring-app:8081", status=~"2..|4..|5..", uri!~"/actuator/prometheus"}) by (method, endpoint)  > 20
        for: 15s
        labels:
          severity: critical
        annotations:
          summary: "Critical HTTP response time"
          description: "The `Monitoring-App` instance {{ $labels.instance }} has an average HTTP response time of {{ humanizeDuration $value }} in the last 15 seconds."

  - name: http_Valid_response_time
    rules:
      - alert: http_Valid_response_time
        expr: max(http_server_requests_seconds_sum{application="Monitoring-App", instance="monitoring-app:8081",status=~"2..",uri=~"/vci/.+|/User/.+|/ProductsInstance/.+|/SupportSession/.+|/DepConfiguration/.+"}) by (method, endpoint) > 5
        for: 1s
        labels:
          severity: warning
        annotations:
          summary: "High HTTP response time"
          description: "The `Monitoring-App` instance {{ $labels.instance }} has an average HTTP response time of {{ humanizeDuration $value }} in the last second."
      - alert: http_Valid_response_time
        expr:  max(http_server_requests_seconds_sum{application="Monitoring-App", instance="monitoring-app:8081",status=~"2..",uri=~"/vci/.+|/User/.+|/ProductsInstance/.+|/SupportSession/.+|/DepConfiguration/.+"}) by (method, endpoint)> 15
        for: 1s
        labels:
          severity: critical
        annotations:
          summary: "Critical HTTP response time"
          description: "The `Monitoring-App` instance {{ $labels.instance }} has an average HTTP response time of {{ humanizeDuration $value }} in the last second."

  - name: http_errors
    rules:
      - alert: http_errors
        expr: sum(http_server_requests_seconds_count{application="Monitoring-App",instance="monitoring-app:8081",status=~"4..|5..", uri=~"/vci/.+|/User/.+|/ProductsInstance/.+|/SupportSession/.+|/DepConfiguration/.+"}) > 1
        for: 1s
        labels:
          severity: warning
        annotations:
          summary: "HTTP errors"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} HTTP errors in the last Second"
      - alert: http_errors
        expr: sum(http_server_requests_seconds_count{application="Monitoring-App",instance="monitoring-app:8081",status=~"4..|5..", uri=~"/vci/.+|/User/.+|/ProductsInstance/.+|/SupportSession/.+|/DepConfiguration/.+"}) > 10
        for: 1s
        labels:
          severity: critical
        annotations:
          summary: "Critical HTTP errors"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} critical HTTP errors in the last Second."

  - name: High_CPU_Busy
    rules:
      - alert: CPU_Used_Application_Error
        expr: absent(system_cpu_usage{instance="monitoring-app:8081", application="Monitoring-App"})
        for: 1s
        labels:
          severity: critical
        annotations:
          summary: "CPU_Used_Application_Error"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} is not returning any CPU usage data"
      - alert: High_CPU_Busy
        expr: system_cpu_usage{exported_application="Monitoring-App"}* 100 ==100
        for: 1s
        labels:
          severity: critical
        annotations:
          summary: "CPU_Busy"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} CPU is High Busy"
      - alert: High_CPU_Busy
        expr: system_cpu_usage{exported_application="Monitoring-App"}* 100 > 85
        for: 1s
        labels:
          severity: warn
        annotations:
          summary: "High_CPU_Busy"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} CPU is Busy"

  - name: High_RAM_Busy
    rules:
      - alert: RAM_Used_Application_Error
        expr: 100 * (sum(jvm_memory_used_bytes{exported_application="Monitoring-App"})/sum(jvm_memory_max_bytes{exported_application="Monitoring-App"})) > 85
        for: 1s
        labels:
          severity: warning
        annotations:
          summary: "High_RAM_Busy"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} RAM is Busy"
      - alert: High_RAM_Busy
        expr: 100 * (sum(jvm_memory_used_bytes{exported_application="Monitoring-App"})/sum(jvm_memory_max_bytes{exported_application="Monitoring-App"})) == 100
        for: 1s
        labels:
          severity: critical
        annotations:
          summary: "High_RAM_Busy"
          description: "The Monitoring-App instance {{ $labels.instance }} has generated {{ $value }} RAM is High Busy"